http://blog.csdn.net/jialinqiang/article/details/8684988

（0） 在zero、first、second、third、fourth中再加一个_first 层级  用来表示街道社区办层级
我计划运营一个街道层面的公众号，这样便于整合街道功能，同时也能够“毕其功于一役”提升公众号的影响力。
街道级地理信息系统可以基于微信公众号上线，利用宣传海报加入公众号，然后添加公众号的成员你自动成为host级别用户（比common低一个级），作为访客用户默认就可以使用地理信息系统的权利，这是一项基本权利。同时还有接受公众号推送了解地区发展的权利，同时还有提交申请成为地区志愿者的权利，当然提交申请成为地区志愿者除了自己需要实名认证外，还需要后台通过ACTIVITI5工作流，进行后台的确认，只有确认通过的host用户才能晋升为common用户。
当然有一种情况除外，那就是通过zero层级、first层级、second层级、third层级这三个层级的专属QRCODE加入到公众号的用户，则只要完成实名认证默认就可以升级成common，当然这也是可以在后台进行设置的。其目的就是方便社区内部志愿者快速组织化，节省审批手续。


（1）角色创建与权限分配只有zero用户（也就是社区书记）拥有，其他层级的管理者都不具备权限分配的功能，这样就省去了我对权限进行层级化分类的痛苦了

（2）对于前端页面显示菜单项的问题，不同层级，甚至是相同层级的用户显示的菜单都是不一样的，我的解决方案是
①当管理者用户（也只有tag=zero、first、second、third、fourth才能在自己的微信菜单上看到扫码登录的功能入口）通过扫码登入系统后，执行redirect请求重定向到管理系统后台的home页。
②系统受到请求后，会通过securityManager.getSubject.getPrimary()获取到当前用户的openid，然后从数据库中查找到该User对象。
③从user对象的grouping字段分析出该用户是什么层级的管理者用户，然后到将对应的层级的set容器返回到栈顶空间（也就是将User直接放入到对象栈顶即可）
④JSP页面，通过Struts2的<s:iterator></s:iterator>对指定的层级Set容器进行遍历，并根据遍历结果直接在页面上构建此一级的菜单项，而不用构建它上一级的菜单项，原因就是当前登录的管理者不需要知道自己上一级是什么，只需要管理好自己以及自己的下级即可。
⑤然后嵌套<s:iterator></s:iterator>迭代当前层级级的子层级级Set容器（也就是实现了LevelInterface的domain的Set集合），用以构筑次一级的菜单，然后如果次一级下面还有次一级，则重复再次嵌套一层遍历，指导到达最底层fourth层
至此，菜单已经构建完毕了，每层菜单在编写url的时候应该以&level=second;id=osjfosuoejfos   来告诉服务器你所请求的是哪一层级的哪一个（用id判定）层级对象。

（3）权限定义，应该以最高权限也就是tag=zero的用户的完整页面为蓝本，对页面上的每个按钮进行权限定义，这样就不会有遗漏，定义的时候也会更方便。

（4）zero用户先定义好每一层级的所拥有的权限，也就是 tag=first的一个Role，second的一个role，以此类推。然后再定义first层级对象，并为层级分配角色，最后在将用户（已经实名认证的）在用户列表中找到，并从common升级到first。然后再将其与定义好的层级对象（first层级的）绑定完成任命操作。

之后first层级的管理者用户登录后台，使用它自己的权限可以进行次一级也就是second级别对象的定义（second_create权限），用来创建次类层级对象，则 创建出来的此层级对象自动拥有自己的Role（权限集合），这个权限集合是有zero用户预先定义好的，其他层级对象无权涉及权限分配和权限设置。然后再在用户列表中选择一个没有职务的common对象，并将其tag设置为second后，将其与新建的second层级对象绑定完成任命操作。之后以此类推。

（5）用户分配原则
①common类型用户，如果不属于任何First层级，那么T会始终出现在First层级管理者才可见的用户列表中，管理者可以将其添加到自己的层级中，自己层级的成员可以在层级成员列表中查看到。
②second层级的管理者，能在成员列表中看到自己层级的成员，或者看到属于自己父层级但不属于任何与自己平级的“零散成员”，并可以将其添加到自己的层级中。
③总原则就是，当前级用户只能看到属于自己父级的用户且用户还没有被自己同级（兄弟）抢走，如果被其他同级兄弟抢走就不可见了，直到同级把该用户解雇出来，又恢复成“无家可归”后才可见。


（6）user表  与   manager表   一对一关系
①user表中只保存关注微信公众号且实名认证用户的基本信息，而如果在后台管理系统中通过更改用户的grouping.tag为first、second、third、fourth，则自动为其在manager中生成一个条一对一的数据条目。
②manager表中存在的主要字段包括常见的 username（与user表中的username相同）、openid、uid、level（与类LevelInterface中的常量是一一对应的），以及用来在FirstLevel、SecondLevel、thirdLevel、fourthLevel四个层级管理表中标注该用户是管理者的mid。
③当后台管理系统，创建了一个层级实例的时候（这里以FirstLevel为例）需要为其分配一个管理者，则首先最高管理员（tag=zero）需要先从用户列表中找到合适人选，然后变更T的标签为first，则系统自动在manager列表中创建一条该用户的一对一的数据。之后zero就可以在FirstLevel中找到自己创建的层级实例对象，并通过修改按钮为其指派一名first层级管理者，然后系统后台会将该层级实例的数据条目的外键中写入被指派的first管理者的mid，至此该层级实例与该first管理者就完成绑定关系，从而也完成了“职责委派”的全过程。
						
					/ FirstLevel
user ---  manager 	- SecondeLevel
					\ ThirdLevel
	(uid一对一)	（mid一对多）


（7）  user表   与  memeber表   一对一关系
①user表中只保存用户的基础数据信息。当tag=common的用户被从总用户列表页“划分”到某一First层级下的时候，
memeber表中会配套创建一个一对一的数据条目，在memeber表中除了常见的uid、openid、sex、age、username等user表中都有的数据字段外
还包括 belongedFirstLevel、belongedSecondLevel、belongedThirdLevel和belongedFourthLevel这四个字段，以及一个无关紧要的mid（可能并不会用到，但为了在member中区分每个条目则作为主键是必须要有的）
②每个tag=common的普通用户，必须首先被“划分”到某一first层级下，执行“划分”的应该是first层级的各个manager管理者。然后管理者就可以在自己层级的用户列表页中看到该用户了，而其他first层级管理者则不能再在总用户列表页面中见到该“有归属”的用户，直到该用户被其所属层级的manager“驱逐”恢复无组织状态的时候，才又能在总用户列表页中见到T。
③first管理者将这个普通用户“划分”到自己层级下后，则该用户的memeber中的belongedFirstLevel就会记录下该first层级实例的flid，用来表示该用户是属于该first层级的。
④之后seconed层级管理者就可以在first层级用户列表中看到刚被“划分”进来的用户了，然后second管理者可以将其再次“划分”到自己的second层级下，与之前first管理者从总用户列表划分用户类似，此时second就可以在自己的second层级用户目录中看到该用户，而其他同级别second管理者不可能再在first层级用户列表中看到这名“有组织”的用户了，直到T被所属的second层级管理者“驱逐”出组织恢复“无组织”状态。
⑤被“划分”到second层级的用户，又会在其memeber表中的belongedSecondLevel中记录下其所归属的second层级的scid，用来表示T目前是属于该层级之下的。
⑥以此类推，third层级和最后的支队fourth层级也是这么完成“划分”的。
⑦当first层级管理者登录系统后台想要查看自己“治理下”的所有用户的时候，DAO只需要凭借该层级的flid在memeber中查找belongedFirstLevel字段就可以找到全部属于该层级的用户，如果向进一步获取用户的详细信息只需要凭借uid到user表中查找即可。方便快捷。

⑧当一级管理者要删除自己所辖范围内的某一用户的时候，则通过DAO在



（8）以积分来驱动“项目管理”，实现志愿者或社团成员参与活动的积分管理管理系统与项目管理系统的结合。
不管是哪个层级创建的活动，所分配的签到积分都是项目等值经费兑换出的积分做基础的，换言之没有积分是凭空出现的，团队账户上如果没有积分，即便能创建活动，参与者签到时候也得不到任何积分进账。
①理由：社会工作服务项目工作方式只有三种――――――个案、小组和社区活动，除去个案工作，剩下的两种形式上是差不多的，都是群体性工作。因此我想到项目管理和积分管理可以合二为一，将项目中人员补助部分的经费兑换成等值的积分，然后由zero按照不同领域的项目分配给first层级，first层级和second层级根据每个项目被承接团队，可以选择<1>周期性自动划拨积分点数<2>按比例划拨积分点数<3>手动划拨积分点数等方式来将项目积分划拨给third团队层级，然后third领队手动向支队长（如果有）划拨积分点数，或者自己在创建活动的时候直接使用积分点数。
②社区基金会的雏形
组建一支协助管理项目预算的社区社会组织，负责管理每一个项目的非人员劳务的部分（物资采购等花费）的花费，需要具备项目管理、财务管理的基本能力。



（9）以面向对象的方式执行“项目管理”
由街道_first 层级对象  创建项目对象，每个项目对象拥有name、range（周期天数）、startDate（20xx-x-x）、endDate（20xx-x-x）、description等基础信息外，还有一个关键成分――――积分。
之后街道将项目对象像“user对象”那样“划分”给特定zero（社区）用户；zero用户将其划分给first用户、first用户划分给second用户、second用户划分给third用户，因此这就要求“项目对象”也必须有memeber表的层级话字段，用于快速定位该“项目对象”目前的层级位置。
之后third层级用户（团队长）在发起活动的时候能在列表中选择自己团队拥有的项目，之后选定项目后再发起专属于该项目的“activity活动”
同时如果最开始指定的团队执行效果不好，则项目管理方（zero/first/second甚至是_first）可以将该项目变更给其他团队或社区执行，这样由于使用该项目积分所发起的活动是与项目对象“一对多”绑定的，因此更改项目的执行方不会让已经花费的积分所开展的活动丢失，新执行方可以继续使用剩余积分继续开展活动，直到完成项目。
这就需要新建另一个团队“应急项目处置小组”负责处置烂尾项目。

（10）社区社会组织（third层级对象）的字段
name、description等外，还应该引入平级。
